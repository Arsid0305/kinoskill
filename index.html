// ==========================================
        // üëá –í–°–¢–ê–í–¨ API-–ö–õ–Æ–ß DEEPSEEK –ù–ò–ñ–ï üëá
        const API_KEY = "sk-2b68062a5a8d4ae1bad063ddaced8f7a"; 
        // ==========================================

        async function runAI() {
            const btn = document.getElementById('mainBtn');
            const old = btn.innerText;
            btn.innerHTML = '<div class="loader"></div> DEEPSEEK –î–£–ú–ê–ï–¢...';
            
            // –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ —Ç–≤–æ–µ–≥–æ —Ñ–∞–π–ª–∞
            const seen = db.sort(()=>0.5-Math.random()).slice(0,15).map(m=>m[cols.t]).join(', ');
            
            const prompt = `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–∏–Ω–æ. –ü–æ—Å–æ–≤–µ—Ç—É–π 1 —Ñ–∏–ª—å–º. 
            –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${picks.mood || '–ª—é–±–æ–µ'}. 
            –ö–æ–º–ø–∞–Ω–∏—è: ${picks.company || '–ª—é–±–∞—è'}. 
            –ñ–∞–Ω—Ä: ${picks.genre || '–ª—é–±–æ–π'}. 
            –Ø —É–∂–µ –≤–∏–¥–µ–ª –∏ –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π –º–Ω–µ: ${seen}.
            
            –û—Ç–≤–µ—Ç –¥–∞–π –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
            {"title":"–ù–∞–∑–≤–∞–Ω–∏–µ","info":"–ì–æ–¥, –°—Ç—Ä–∞–Ω–∞, –ñ–∞–Ω—Ä","reason":"–ü–æ—á–µ–º—É —ç—Ç–æ —Å—Ç–æ–∏—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å (2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)"}`;

            try {
                const req = await fetch("https://api.deepseek.com/v1/chat/completions", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {role: "system", content: "You are a helpful movie recommender. Respond only in JSON."},
                            {role: "user", content: prompt}
                        ],
                        response_format: { type: 'json_object' }, // –ß—Ç–æ–±—ã –ò–ò —Ç–æ—á–Ω–æ –≤—ã–¥–∞–ª JSON
                        stream: false
                    })
                });

                if(!req.ok) {
                    const errData = await req.json();
                    throw new Error(errData.error?.message || `–û—à–∏–±–∫–∞ ${req.status}`);
                }

                const ans = await req.json();
                const resultText = ans.choices[0].message.content;
                
                // –ü–∞—Ä—Å–∏–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ –ò–ò
                const json = JSON.parse(resultText.replace(/```json|```/g,'').trim());
                show(json.title, json.info, json.reason);

            } catch(e) {
                alert("–û—à–∏–±–∫–∞ DeepSeek: " + e.message);
                console.error(e);
            } finally {
                btn.innerText = old;
            }
        }
